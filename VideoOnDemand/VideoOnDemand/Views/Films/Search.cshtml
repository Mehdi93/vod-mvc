@model VideoOnDemand.Models.Film

@{
    ViewBag.Title = "Search";
}

<link href="~/Content/bootstrap-datepicker.css" rel="stylesheet" type="text/css" />
<script src="~/Scripts/bootstrap-datepicker.js"></script>

<h2>Search</h2>

<div id="formRecherche">
    <div class="form-group">
        @Html.Label("listeThemes", "Thème")
        @Html.DropDownList("listeThemes", new SelectList(ViewBag.listeThemes), new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.Label("listeNationalities", "Nationnalité")
        @Html.DropDownList("listeNationalities", new SelectList(ViewBag.listeNationalities), new { @class = "form-control" })
    </div>
    
    <div id="datePicker" class="input-daterange">
        @Html.Label("datePicker", "Date de sortie")
        <input id="dateInfRecherche" type="text" class="input-small"/>
        <span>à</span>
        <input id="dateSupRecherche" type="text" class="input-small" />
    </div>

    <ul id="triFilms" class="list-group"></ul>

    <button id="startRecherche" type="submit" class="btn btn-default btn-primary">Rechercher</button>
</div>
<script>
    $(document).ready(function () {

        //options du datepicker
        $('.input-daterange').datepicker({
            format: "dd/mm/yyyy",
            weekStart: 1,
            language: "fr",
            orientation: "top auto"
        });

        $("#startRecherche").on("click", function () {
            $.ajax({
                type: "POST",
                url: '@Url.Action("Resultats", "Films")',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({
                    "Theme": $("#listeThemes").val(),
                    "Nationality": $("#listeNationalities").val(),
                    "AddInfDate": $("#dateInfRecherche").val(),
                    "AddSupDate": $("#dateSupRecherche").val()
                }),
                dataType: "json",
                success: afficheResultats,
                error: erreurResultats
            });
        });
        function afficheResultats(result) {
            $("#triFilms").empty();
            jQuery.each(result, function (i, val) {
                $("#triFilms").append("<li data-idFilm="+val.Id+">"+val.Name+"</li>");
            });
        }
        function erreurResultats() {
            $("#triFilms").html("<li>Erreur, veuillez réessayer</li>");
        }
    });
</script>
